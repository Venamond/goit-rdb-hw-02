# 2️⃣ Друга нормальна форма (2NF)


## 📖 Визначення

**Друга нормальна форма (2NF)** - це рівень нормалізації, який вимагає, щоб таблиця була в 1NF і всі неключові атрибути повністю залежали від **усього** первинного ключа, а не від його частини.

## ✅ Вимоги 2NF

Таблиця знаходиться в 2NF, якщо:

1. ✅ Таблиця знаходиться в **1NF**
2. ✅ Немає **часткових залежностей** від складеного ключа
3. ✅ Кожен неключовий атрибут залежить від **повного** первинного ключа

> **💡 Примітка:** Якщо первинний ключ простий (не складений), таблиця автоматично в 2NF, якщо вона в 1NF.

---

## ❌ Проблеми таблиці 1NF

### Вихідна таблиця (1NF):

| Номер_замовлення | Назва_товару | Кількість | Адреса_клієнта | Дата_замовлення | Клієнт |
|------------------|--------------|-----------|----------------|-----------------|---------|
| 101 | Лептоп | 3 | Хрещатик 1 | 2023-03-15 | Мельник |
| 101 | Мишка | 2 | Хрещатик 1 | 2023-03-15 | Мельник |
| 102 | Принтер | 1 | Басейна 2 | 2023-03-16 | Шевченко |
| 103 | Мишка | 4 | Комп'ютерна 3 | 2023-03-17 | Коваленко |

**Первинний ключ:** `(Номер_замовлення, Назва_товару)`

### 🚨 Виявлені порушення 2NF:

---

### Функціональні залежності в таблиці:

```
Первинний ключ: (Номер_замовлення, Назва_товару)
```

#### ✅ Повні залежності (правильні):
```
(Номер_замовлення, Назва_товару) → Кількість
```
**Пояснення:** Кількість залежить від ОБОХ частин ключа (який товар і в якому замовленні)

#### ❌ Часткові залежності (проблемні):
```
Номер_замовлення → Адреса_клієнта
Номер_замовлення → Дата_замовлення
Номер_замовлення → Клієнт
```
**Пояснення:** Ці атрибути залежать лише від **частини** ключа (Номер_замовлення), а не від повного ключа!

### 📊 Візуалізація залежностей:

```
┌─────────────────────────────────────────┐
│     Первинний ключ (складений)          │
│  (Номер_замовлення, Назва_товару)       │
└──────────┬────────────────┬─────────────┘
           │                │
           │                │
    ┌──────▼──────┐  ┌─────▼──────────┐
    │ Кількість   │  │ Адреса_клієнта │ ❌
    │ (ОК)        │  │ Дата_замовлення│ ❌
    │ ✅ Повна    │  │ Клієнт         │ ❌
    │ залежність  │  │ ⚠️  Часткова   │
    │             │  │ залежність     │
    └─────────────┘  └────────────────┘
```

---

## 🔧 Процес нормалізації

### Крок 1: Групування атрибутів за залежностями

**Група 1: Залежать від Номер_замовлення**
- Номер_замовлення *(первинний ключ)*
- Адреса_клієнта
- Дата_замовлення
- Клієнт

**Група 2: Залежать від (Номер_замовлення, Назва_товару)**
- Номер_замовлення *(частина первинного ключа)*
- Назва_товару *(частина первинного ключа)*
- Кількість

### Крок 2: Створення окремих таблиць

Кожна група стає окремою таблицею з відповідним первинним ключем.

---

## ✅ Результат

### Таблиця 1: **Замовлення**

| Номер_замовлення | Адреса_клієнта | Дата_замовлення | Клієнт |
|------------------|----------------|-----------------|---------|
| 101 | Хрещатик 1 | 2023-03-15 | Мельник |
| 102 | Басейна 2 | 2023-03-16 | Шевченко |
| 103 | Комп'ютерна 3 | 2023-03-17 | Коваленко |

**Первинний ключ:** `Номер_замовлення`

**Функціональні залежності:**
```
Номер_замовлення → Адреса_клієнта
Номер_замовлення → Дата_замовлення
Номер_замовлення → Клієнт
```

---

### Таблиця 2: **Деталі_замовлення**

| Номер_замовлення | Назва_товару | Кількість |
|------------------|--------------|-----------|
| 101 | Лептоп | 3 |
| 101 | Мишка | 2 |
| 102 | Принтер | 1 |
| 103 | Мишка | 4 |

**Первинний ключ:** `(Номер_замовлення, Назва_товару)`  
**Зовнішній ключ:** `Номер_замовлення` → Замовлення(Номер_замовлення)

**Функціональні залежності:**
```
(Номер_замовлення, Назва_товару) → Кількість
```

---

## 🔗 Зв'язки між таблицями

```
┌─────────────────────┐
│   Замовлення        │
│                     │
│ PK: Номер_замовлення│
│     Адреса_клієнта  │
│     Дата_замовлення │
│     Клієнт          │
└──────────┬──────────┘
           │
           │ 1
           │
           │ ∗
           │
┌──────────▼──────────┐
│ Деталі_замовлення   │
│                     │
│ PK: (Номер_замовл., │
│      Назва_товару)  │
│ FK: Номер_замовлення│
│     Кількість       │
└─────────────────────┘
```

**Кардинальність:** Один до багатьох (1:∗)
- Одне замовлення може містити багато товарів
- Кожен товар у деталях належить лише одному замовленню

---

## 📊 Порівняння: 1NF vs 2NF

| Аспект | 1NF | 2NF |
|--------|-----|-----|
| **Кількість таблиць** | 1 | 2 |
| **Дублювання даних** | Високе | Зменшене |
| **Часткові залежності** | ❌ Присутні | ✅ Усунені |
| **Аномалії оновлення** | Високі | Зменшені |

---

## 📈 Переваги структури 2NF

### 1. ✅ Зменшення дублювання

**До (1NF):** Адреса клієнта повторюється для кожного товару
```
101 | Лептоп  | 3 | Хрещатик 1 | ...
101 | Мишка   | 2 | Хрещатик 1 | ... ← Дублювання!
```

**Після (2NF):** Адреса зберігається один раз
```
Замовлення:
101 | Хрещатик 1 | ...
```
