# 3️⃣ Третя нормальна форма (3NF)


## 📖 Визначення

**Третя нормальна форма (3NF)** - це рівень нормалізації, який вимагає, щоб таблиця була в 2NF і не мала транзитивних залежностей між неключовими атрибутами.

> **Транзитивна залежність** - це ситуація, коли неключовий атрибут залежить від іншого неключового атрибута, а не безпосередньо від первинного ключа.

---

## ✅ Вимоги 3NF

Таблиця знаходиться в 3NF, якщо:

1. ✅ Таблиця знаходиться в **2NF**
2. ✅ Немає **транзитивних залежностей**
3. ✅ Всі неключові атрибути залежать **безпосередньо** від первинного ключа
4. ✅ Неключові атрибути **незалежні** один від одного

---

## ❌ Проблеми таблиць 2NF

### Таблиця "Замовлення" (2NF):

| Номер_замовлення | Адреса_клієнта | Дата_замовлення | Клієнт |
|------------------|----------------|-----------------|---------|
| 101 | Хрещатик 1 | 2023-03-15 | Мельник |
| 102 | Басейна 2 | 2023-03-16 | Шевченко |
| 103 | Комп'ютерна 3 | 2023-03-17 | Коваленко |

**Первинний ключ:** `Номер_замовлення`

### Таблиця "Деталі_замовлення" (2NF):

| Номер_замовлення | Назва_товару | Кількість |
|------------------|--------------|-----------|
| 101 | Лептоп | 3 |
| 101 | Мишка | 2 |
| 102 | Принтер | 1 |
| 103 | Мишка | 4 |

**Первинний ключ:** `(Номер_замовлення, Назва_товару)`

---

### 🚨 Проблема в таблиці "Замовлення"

#### Функціональні залежності:
```
Прямі залежності:
Номер_замовлення → Клієнт         ✅
Номер_замовлення → Дата_замовлення ✅

Транзитивна залежність:
Номер_замовлення → Клієнт → Адреса_клієнта ❌
```

### 📊 Візуалізація транзитивної залежності:

```
┌──────────────────┐
│ Номер_замовлення │ (Первинний ключ)
└────────┬─────────┘
         │
         │ (прямо)
         ▼
    ┌────────┐
    │ Клієнт │ (Неключовий атрибут)
    └────┬───┘
         │
         │ (транзитивно)
         ▼
  ┌──────────────┐
  │Адреса_клієнта│ ❌ Транзитивна залежність!
  └──────────────┘
```

**Пояснення:**
- `Адреса_клієнта` залежить від `Клієнт`
- `Клієнт` залежить від `Номер_замовлення`
- Отже, `Адреса_клієнта` **транзитивно** залежить від `Номер_замовлення` через `Клієнт`

---

### 🚨 Проблема в таблиці "Деталі_замовлення"

Хоча ця таблиця в 2NF, є проблема:

**"Назва_товару" використовується як частина первинного ключа**

Проблеми:
1. ❌ Дублювання назв товарів у різних замовленнях
2. ❌ Немає можливості зберігати додаткову інформацію про товари
3. ❌ Проблеми з консистентністю (можливі помилки в написанні)
4. ❌ Складно змінити назву товару (треба оновити всі деталі)

---

## 🔧 Процес нормалізації

### Крок 1: Розділення таблиці "Замовлення"

Виділяємо інформацію про клієнтів в окрему таблицю:

**Що виносимо:**
- Клієнт (стає первинним ключем)
- Адреса_клієнта (залежить від клієнта)

**Що залишається:**
- Номер_замовлення
- Дата_замовлення
- ID_клієнта (зовнішній ключ)

### Крок 2: Створення таблиці "Товари"

Виділяємо інформацію про товари:

**Що виносимо:**
- ID_товару (новий первинний ключ)
- Назва_товару

**Що змінюється в "Деталі_замовлення":**
- Замість "Назва_товару" використовуємо "ID_товару"

---

## ✅ Результат

### 🗂️ Фінальна структура з 4 таблиць

---

### Таблиця 1: **Клієнти**

| ID_клієнта | Ім'я_клієнта | Адреса_клієнта |
|------------|--------------|----------------|
| 1 | Мельник | Хрещатик 1 |
| 2 | Шевченко | Басейна 2 |
| 3 | Коваленко | Комп'ютерна 3 |

**Первинний ключ:** `ID_клієнта`

**Функціональні залежності:**
```
ID_клієнта → Ім'я_клієнта
ID_клієнта → Адреса_клієнта
```

✅ Немає транзитивних залежностей  
✅ Всі атрибути залежать безпосередньо від ключа

---

### Таблиця 2: **Замовлення**

| Номер_замовлення | ID_клієнта | Дата_замовлення |
|------------------|------------|-----------------|
| 101 | 1 | 2023-03-15 |
| 102 | 2 | 2023-03-16 |
| 103 | 3 | 2023-03-17 |

**Первинний ключ:** `Номер_замовлення`  
**Зовнішній ключ:** `ID_клієнта` → Клієнти(ID_клієнта)

**Функціональні залежності:**
```
Номер_замовлення → ID_клієнта
Номер_замовлення → Дата_замовлення
```

✅ Немає транзитивних залежностей  
✅ Транзитивний шлях розірваний (замість Клієнт → Адреса тепер ID → Клієнти)

---

### Таблиця 3: **Товари**

| ID_товару | Назва_товару |
|-----------|--------------|
| 1 | Лептоп |
| 2 | Мишка |
| 3 | Принтер |

**Первинний ключ:** `ID_товару`

**Функціональні залежності:**
```
ID_товару → Назва_товару
```

✅ Проста структура  
✅ Легко розширювати (можна додати ціну, категорію, тощо)

---

### Таблиця 4: **Деталі_замовлення**

| Номер_замовлення | ID_товару | Кількість |
|------------------|-----------|-----------|
| 101 | 1 | 3 |
| 101 | 2 | 2 |
| 102 | 3 | 1 |
| 103 | 2 | 4 |

**Первинний ключ:** `(Номер_замовлення, ID_товару)`  
**Зовнішні ключі:**
- `Номер_замовлення` → Замовлення(Номер_замовлення)
- `ID_товару` → Товари(ID_товару)

**Функціональні залежності:**
```
(Номер_замовлення, ID_товару) → Кількість
```

✅ Асоціативна таблиця для зв'язку багато-до-багатьох  
✅ Використання числових ID замість текстових назв

---

## 🔗 Фінальна структура БД

### Схема зв'язків:

```
┌─────────────────┐
│    Клієнти      │
│                 │
│ PK: ID_клієнта  │
│   Ім'я_клієнта  │
│   Адреса_клієнта│
└────────┬────────┘
         │
         │ 1
         │
         │ ∗
         │
┌────────▼────────┐
│   Замовлення    │
│                 │
│ PK: Номер_замов │
│ FK: ID_клієнта  │
│   Дата_замовлен │
└────────┬────────┘
         │
         │ 1
         │
         │ ∗
         │
┌────────▼────────┐         ┌─────────────┐
│Деталі_замовлення│         │   Товари    │
│                 │         │             │
│PK: (Номер_замов,│∗───────∗│PK: ID_товару│
│     ID_товару)  │   ∗  1  │  Назва_товар│
│FK: Номер_замов  │         └─────────────┘
│FK: ID_товару    │
│    Кількість    │
└─────────────────┘
```

### Типи зв'язків:

1. **Клієнти ↔ Замовлення**: один до багатьох (1:∗)
   - Один клієнт може мати багато замовлень
   - Кожне замовлення належить одному клієнту

2. **Замовлення ↔ Деталі_замовлення**: один до багатьох (1:∗)
   - Одне замовлення може містити багато позицій
   - Кожна позиція належить одному замовленню

3. **Товари ↔ Деталі_замовлення**: один до багатьох (1:∗)
   - Один товар може бути в багатьох замовленнях
   - Кожна позиція відноситься до одного товару

4. **Замовлення ↔ Товари**: багато до багатьох (∗:∗)
   - Реалізовано через асоціативну таблицю "Деталі_замовлення"

---

## 📊 Порівняння всіх форм

| Аспект | Початкова | 1NF | 2NF | 3NF |
|--------|-----------|-----|-----|-----|
| **Таблиць** | 1 | 1 | 2 | 4 |
| **Атомарність** | ❌ | ✅ | ✅ | ✅ |
| **Часткові залежності** | - | ❌ | ✅ | ✅ |
| **Транзитивні залежності** | ❌ | ❌ | ❌ | ✅ |
| **Дублювання** | Високе | Дуже високе | Середнє | Мінімальне |
| **Цілісність** | Низька | Низька | Середня | Висока |
| **Гнучкість** | Низька | Низька | Середня | Висока |

---

## 🎯 Переваги структури 3NF

### 1. ✅ Повне усунення дублювання

**Приклад: Зміна адреси клієнта**

**До 3NF (таблиця 2NF):**
```
Замовлення:
101 | Хрещатик 1 | ... | Мельник
104 | Хрещатик 1 | ... | Мельник  ← Дублювання адреси!
```

**Після 3NF:**
```
Клієнти:
1 | Мельник | Хрещатик 1  ← Адреса один раз!

Замовлення:
101 | 1 | ...
104 | 1 | ...
```
